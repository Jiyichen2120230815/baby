<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.babyTalk.core.article.mapper.ArticleMapper">

    <resultMap id="getArticleList" type="com.babyTalk.core.article.entity.VO.ArticleVO">
        <result column="classification_ids" property="classificationIds" typeHandler="com.babyTalk.base.handler.JsonTypeHandler"/>
    </resultMap>

    <select id="getAllArticlePage" resultMap="getArticleList">
        select DISTINCT t1.*,t2.nickname from (select b1.* from (article b1 left join article_classification b2 on b1.id = b2.article_id) left join classification b3 on b3.id = b2.classification_id
        <where>
            <if test="articlePageVO.classification!=null and articlePageVO.classification!=''">
                b3.`name` like concat('%',#{articlePageVO.classification},'%')
            </if>
        </where>
        )
        t1 left join user t2 on t1.user_id = t2.id
        <where>
            <if test="articlePageVO.id!=null and articlePageVO.id!=''">
                AND t1.id like concat('%',#{articlePageVO.id},'%')
            </if>
            <if test="articlePageVO.nickname!=null and articlePageVO.nickname!=''">
                AND t2.nickname like concat('%',#{articlePageVO.nickname},'%')
            </if>
            <if test="articlePageVO.title!=null and articlePageVO.title!=''">
                AND t1.title like concat('%',#{articlePageVO.title},'%')
            </if>
            <if test="articlePageVO.content!=null and articlePageVO.content!=''">
                AND t1.content like concat('%',#{articlePageVO.content},'%')
            </if>

        </where>
        ORDER BY t1.created_at DESC , t1.updated_at DESC
    </select>

</mapper>
